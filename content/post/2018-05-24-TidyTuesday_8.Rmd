---
title: "Tidy Tuesday - Week 8"
author: "David Mas-Ponte"
date: 2015-07-23T21:13:14-05:00
categories: ["R"]
tags: ["Tidy Tuesday", "plot"]
---

```{r setup}
knitr::opts_chunk$set(collapse = TRUE)

library(magrittr)
library(ggplot2)
```

## Honney Data

This time the amazing people at [R4DS]() have provided us with a dataset of Honney production in the USA. Trying to fulfill my promise of reproducibility and "everything can be done in R" principle, I download directly the data within my R session. (see [order a pizza in R](https://tolstoy.newcastle.edu.au/R/help/04/06/1672.html))

**Note** that this approach will download the file everytime you execute your code. This may be not the most smart thing to do. For instance you may need to run this code offline or more likely a real-life dataset will be very big to re-download everytime. 

```{r message=FALSE, warning=FALSE}
url = "https://github.com/rfordatascience/tidytuesday/raw/master/data/week8_honey_production.zip"
download.file(url,destfile = "honney_files.zip")
utils::unzip("honney_files.zip")
dat = readr::read_csv("honeyproduction.csv")
```


First, let`s have a look to the data. This is important to me to know the column names and the type of data vizzs I am intereseted in. From this dataset, I think the evolution of Honney production in the US is pretty interesting to see.

```{r cars}
dat %>%  head %>% knitr::kable(caption = "Quick data view contained in the dataset.")
```

## Plots

In this first example I check how the global production of Honney changes in the available years. We can see that globally the production of Honney has dropped to almost 75% of the original production in 15 years. We can also observe a huge heterogeneity in each state represented in this plot by a "box".

```{r}
p0 = dat %>% ggplot(aes(x = year,y = totalprod)) +
  geom_bar(stat="identity",fill=NA, color = "black") +
  cowplot::theme_cowplot() +
  theme(axis.ticks = element_blank(),
        axis.title.x = element_blank(),
        axis.line.x = element_blank(),
        axis.text.x = element_blank())
p0
```

Then, we can explore the production of each state evolution. However, to avoid a common overplotting problem we will focus our analysis in the TOP5 states producing Honney. 

```{r}
dat$label = dat$state
states = dat[order(dat$totalprod,decreasing = T),]$state
top5 = unique(states)[1:5]
dat[!dat$label %in% top5,]$label = "Rest"
p1 = dat %>% ggplot(aes(x = year,y = totalprod, color =label)) +
  geom_point(alpha = 0.1) +
  geom_smooth(method = "lm",se = FALSE)+ 
  cowplot::theme_cowplot() +
  theme(panel.grid.major.y = element_line(color = "gray",
                                          linetype = "dashed"),
        axis.ticks = element_blank(),
        legend.position = "bottom") +
  scale_y_sqrt(labels = scales::comma) +
  scale_color_brewer(palette = "Set2")

p1
```

From the plot we can see super clearly that meanwhile Florida, California and South Dakota are decreasing its production, North Dakota is now on top of the ranking. 

Another interesting data to explore is the evolution of the price of Honney. I would think honney should be more expensive now, but is there any interesting year to look into?


```{r}
p2 = dat %>% ggplot(aes(x = factor(year),y=priceperlb)) + 
  geom_boxplot() +
  cowplot::theme_cowplot() +
  theme(axis.ticks = element_blank()) 

p2
```

We can easily see in the huge increase of price in 2002. Apparently, a low production of honney in the US combined with removing argentina producers out of the market [source](https://www.nytimes.com/2002/03/05/business/us-and-argentina-fight-over-honey.html) could be the reason. 

Finally, we can generate a whole figure plot.

```{r pie, fig.cap='A fancy pie chart.', fig.height=10, fig.width=16, tidy=FALSE}
c1 = cowplot::plot_grid(p0,p1,ncol = 1,align = "v")
fp = cowplot::plot_grid(c1,p2 + coord_flip(),rel_widths = c(0.6,.4))
fp
```
